<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DamiTools ‚Äî Create Account</title>
  <meta name="description" content="Create your DamiTools account for easy access and payments"/>
  <style>
    :root {
      --bg:#0e0f11; --card:#16181d; --muted:#a1a1aa;
      --brand:#00b4d8; --accent:#10b981;
    }
    body {
      margin:0;
      background:var(--bg);
      font-family:system-ui,Arial;
      color:#fff;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
    }
    .card {
      background:var(--card);
      padding:32px;
      border-radius:16px;
      width:90%;
      max-width:400px;
      box-shadow:0 4px 10px rgba(0,0,0,0.5);
      text-align:center;
    }
    h1 { margin-bottom:10px; }
    p.muted { color:var(--muted); font-size:14px; margin-bottom:24px; }
    input {
      width:100%;
      padding:12px;
      border:none;
      border-radius:8px;
      margin:8px 0;
      background:#1f2229;
      color:#fff;
    }
    button {
      width:100%;
      padding:12px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      margin-top:10px;
      transition:0.25s;
    }
    .btn-brand { background:var(--brand); color:#fff; }
    .btn-brand:hover { background:#0090b3; }
    .btn-phone { background:var(--accent); color:#fff; }
    .btn-facebook { background:#1877f2; color:#fff; }
    .divider {
      margin:20px 0;
      border-bottom:1px solid rgba(255,255,255,0.1);
      position:relative;
    }
    .divider span {
      position:absolute;
      top:-10px;
      background:var(--card);
      left:50%;
      transform:translateX(-50%);
      padding:0 10px;
      color:var(--muted);
      font-size:12px;
    }
    #recaptcha-container {
      margin-top:10px;
      display:none;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Create Account üõ†Ô∏è</h1>
    <p class="muted">Join DamiTools today</p>

    <!-- Email signup -->
    <div id="emailSignup">
      <input type="text" id="name" placeholder="Full name"/>
      <input type="email" id="email" placeholder="Email address"/>
      <input type="password" id="password" placeholder="Create password"/>
      <button class="btn-brand" id="signupBtn">Create Account</button>
    </div>

    <div class="divider"><span>OR</span></div>

    <!-- Phone signup -->
    <div id="phoneSignup">
      <input type="tel" id="phoneNumber" placeholder="+2348123456789"/>
      <div id="recaptcha-container"></div>
      <button class="btn-phone" id="sendCodeBtn">Send Verification Code</button>
      <input type="text" id="verifyCode" placeholder="Enter code" style="display:none;"/>
      <button class="btn-accent" id="verifyBtn" style="display:none;">Verify & Register</button>
    </div>

    <div class="divider"><span>OR</span></div>

    <!-- Facebook signup -->
    <button class="btn-facebook" id="facebookBtn">Sign up with Facebook</button>

    <p class="muted" style="margin-top:20px;">
      Already have an account? <a href="login.html" style="color:var(--brand)">Login</a>
    </p>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
    // ‚úÖ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA2lx1hb2qZsYaXrQhsUp7hepYu5nY3fgs",
      authDomain: "damitools.firebaseapp.com",
      projectId: "damitools",
      storageBucket: "damitools.firebasestorage.app",
      messagingSenderId: "875796385681",
      appId: "1:875796385681:web:563ffc58665bdc94875430"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ‚úÖ Email signup
    const signupBtn = document.getElementById("signupBtn");
    signupBtn.onclick = async () => {
      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!name || !email || !password) {
        alert("Please fill all fields");
        return;
      }

      try {
        const userCred = await auth.createUserWithEmailAndPassword(email, password);
        await userCred.user.updateProfile({ displayName: name });
        await db.collection("users").doc(userCred.user.uid).set({
          name, email, createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        window.location.href = "account.html";
      } catch (err) {
        alert(err.message);
      }
    };

    // ‚úÖ Phone signup
    const recaptcha = new firebase.auth.RecaptchaVerifier('recaptcha-container', { size: 'invisible' });
    const phoneBtn = document.getElementById("sendCodeBtn");
    const verifyBtn = document.getElementById("verifyBtn");
    const phoneInput = document.getElementById("phoneNumber");
    const codeInput = document.getElementById("verifyCode");

    phoneBtn.onclick = () => {
      const number = phoneInput.value.trim();
      if (!number.startsWith("+")) {
        alert("Include your country code (e.g. +234...)");
        return;
      }
      auth.signInWithPhoneNumber(number, recaptcha)
        .then(result => {
          window.confirmationResult = result;
          alert("Code sent! Check your SMS.");
          codeInput.style.display = "block";
          verifyBtn.style.display = "block";
        })
        .catch(err => alert(err.message));
    };

    verifyBtn.onclick = () => {
      const code = codeInput.value.trim();
      if (!code) return alert("Enter code");
      confirmationResult.confirm(code)
        .then(result => {
          const user = result.user;
          db.collection("users").doc(user.uid).set({
            phone: user.phoneNumber,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          window.location.href = "account.html";
        })
        .catch(err => alert(err.message));
    };

    // ‚úÖ Facebook signup
    document.getElementById("facebookBtn").onclick = () => {
      const provider = new firebase.auth.FacebookAuthProvider();
      auth.signInWithPopup(provider)
        .then(result => {
          const user = result.user;
          db.collection("users").doc(user.uid).set({
            name: user.displayName || "",
            email: user.email || "",
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          window.location.href = "account.html";
        })
        .catch(err => alert(err.message));
    };

    // ‚úÖ Redirect logged in users
    auth.onAuthStateChanged(user => {
      if (user) window.location.href = "account.html";
    });
  </script>
</body>
</html>
